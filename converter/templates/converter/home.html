{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link type="text/css" href="{% static 'converter/css/base.css' %}" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css" integrity="sha512-o5v54Kh5PH0dgnf9ei0L+vMRsbm5fvIvnR/XkrZZjN4mqdaeH7PW66tumBoQVIaKNVrLCZiBEfHzRY4JJSMK/Q==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Document</title>
</head>
<body>
    <nav class="navbar justify-content-center justify-content-md-start px-5">
        <a class="navbar-brand fs-3 fw-bolder" href="/">XJ Convert</a>
      </nav>
    <div class="container-fluid px-1 px-md-5">
        <div class="row mt-4 mb-4">
            <div class="col-12 d-flex justify-content-center">
                <div class="row text-center">
                    <div class="col-12 fs-2 fw-bolder mb-2">
                        XML <span class="bi bi-arrow-left-right swap-button"></span> JSON
                    </div>
                    <div class="col-12 fs-5 fw-light mb-3">
                        <div class="row justify-content-center">
                            <div class="col-12 d-none d-md-block">Наш сервис определит формат ответа </div>
                            <div class="col-12 d-none d-md-block">и предоставит ответ в <span class="fw-medium">XML</span> и <span class="fw-medium">JSON</span></div>
                            <div class="col-12 d-block d-md-none">Наш сервис определит формат ответа и предоставит ответ в <span class="fw-medium">XML</span> и <span class="fw-medium">JSON</span></div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="row justify-content-center">
                            <div class="col-12 d-flex gap-2">
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text" id="basic-addon3"><i class="bi bi-link"></i></span>
                                    <input type="text" class="form-control" id="basic-url" placeholder="https://example.ru" aria-describedby="basic-addon3">
                                </div>
                                <button id="fetchButton" class="btn d-flex align-items-center button-style-1 h-100 gap-2 fw-bolder px-3 px-md-5">
                                    <div class="fs-5 d-none d-md-flex">GET</div>
                                    <i class="bi bi-send fs-5"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mb-4 position-relative">
            <div id="loader" class="d-none d-flex justify-content-center position-absolute w-100 h-100 align-items-center rounded" style="background: rgba(0, 0, 0, 0.081);">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
            <div class="col-12 col-md-6">
                <div class="row">
                    <div class="col-12">
                        <div class="d-flex justify-content-between">
                            <div class="d-flex align-items-center gap-2">
                                <div class="fs-4">JSON</div>
                                <div class="fs-6 text-success d-none" id="json-responce">Ответ сервера</div>
                            </div>
                            <div>
                                <button class="swap-button fs-4" id="JSON-copy">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-copy" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z"/>
                                    </svg>
                                </button>
                                <button class="swap-button fs-4" id="saveBtnJSON">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
                                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                                        <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
                                      </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <pre><code id="json-code" class="language-json"></code></pre>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-6">
                <div class="row">
                    <div class="col-12">
                        <div class="d-flex justify-content-between">
                            <div class="d-flex align-items-center gap-2">
                                <div class="fs-4">XML</div>
                                <div class="fs-6 text-success d-none" id="xml-responce">Ответ сервера</div>
                            </div>
                            <div>
                                <button class="swap-button fs-4" id="XML-copy">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-copy" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z"/>
                                    </svg>
                                </button>
                                <button class="swap-button fs-4" id="saveBtnXML">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
                                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                                        <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
                                      </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <pre><code id="xml-code" class="language-xml"></code></pre>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mb-5">
            <div class="col-12 col-md-4 p-2">
                <div class="row text-center">
                    <div class="col-12 fs-3 mb-1">
                        <i class="bi bi-shield-fill-check"></i>
                    </div>
                    <div class="col-12 fs-5 mb-2 fw-bold">
                        Конфиденциальность
                    </div>
                    <div class="col-12 fs-6 fw-light">
                        Мы гарантируем полную конфиденциальность ваших данных. Никакая информация не передается сторонним сервисам и не сохраняется на наших серверах, что обеспечивает максимальную безопасность для всех пользователей.
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-4 p-2">
                <div class="row text-center">
                    <div class="col-12 fs-3 mb-1">
                        <i class="bi bi-clock-fill"></i>
                    </div>
                    <div class="col-12 fs-5 mb-2 fw-bold">
                        Время
                    </div>
                    <div class="col-12 fs-6 fw-light">
                        Наш сервис разработан для максимально быстрой обработки запросов. Независимо от сложности задачи, вы получите результат практически мгновенно, что экономит ваше время и повышает эффективность работы.
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-4 p-2">
                <div class="row text-center">
                    <div class="col-12 fs-3 mb-1">
                        <i class="bi bi-hand-thumbs-up-fill"></i>
                    </div>
                    <div class="col-12 fs-5 mb-2 fw-bold">
                        Качество
                    </div>
                    <div class="col-12 fs-6 fw-light">
                        Мы гордимся качеством нашего сервиса, что подтверждается высоким уровнем удовлетворенности наших пользователей. Более 2 довольных клиентов уже воспользовались нашими услугами и оставили положительные отзывы.
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="container-fluid px-1 px-md-5 footer">
        <div class="row h-100 align-items-center">
            <div>
                <div class="col-12 text-center fw-bold fs-1 mb-2">XJ Convert</div>
                <div class="col-12 text-center fw-light fs-6">© 2024, Dmitry Chupakhin. All rights reserved.</div>
            </div>
        </div>
    </footer>
    <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="errorModalLabel">Ошибка</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modalErrorMessage">
              Произошла ошибка при выполнении запроса.
            </div>
            <div class="modal-footer">
              <button type="button" class="btn d-flex align-items-center button-style-1 px-4 py-2 fs-6" data-bs-dismiss="modal">Закрыть</button>
            </div>
          </div>
        </div>
      </div>

    <script src="https://cdn.jsdelivr.net/npm/xml-formatter@3.6.2/dist/browser/xml-formatter-singleton.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/xml-js@1.6.11/dist/xml-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/xml.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
    <script>
        document.getElementById('saveBtnJSON').addEventListener('click', function() {
            // Получаем содержимое блока div
            var content = document.getElementById('json-code').textContent;

            // Создаем Blob с содержимым
            var blob = new Blob([content], { type: 'text/plain' });

            // Создаем ссылку для скачивания
            var link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'JSON.txt';

            // Кликаем на ссылку для скачивания файла
            link.click();

            // Освобождаем объект URL
            URL.revokeObjectURL(link.href);
        });
        document.getElementById('saveBtnXML').addEventListener('click', function() {
            // Получаем содержимое блока div
            var content = document.getElementById('xml-code').textContent;

            // Создаем Blob с содержимым
            var blob = new Blob([content], { type: 'text/plain' });

            // Создаем ссылку для скачивания
            var link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'XML.txt';

            // Кликаем на ссылку для скачивания файла
            link.click();

            // Освобождаем объект URL
            URL.revokeObjectURL(link.href);
        });
        document.getElementById('JSON-copy').addEventListener('click', () => {
            const textToCopy = document.getElementById('json-code').textContent;

            // Используем API буфера обмена
            navigator.clipboard.writeText(textToCopy).then(() => {
                // Показать сообщение об успешном копировании
            }).catch(err => {
                // Показать сообщение об ошибке
            });
        });
        document.getElementById('XML-copy').addEventListener('click', () => {
            const textToCopy = document.getElementById('xml-code').textContent;

            // Используем API буфера обмена
            navigator.clipboard.writeText(textToCopy).then(() => {
                // Показать сообщение об успешном копировании
            }).catch(err => {
                // Показать сообщение об ошибке
            });
        });
        document.getElementById('fetchButton').addEventListener('click', fetchData);
        //https://api.open-meteo.com/v1/forecast?latitude=52.52&longitude=13.41&current=temperature_2m,wind_speed_10m&hourly=temperature_2m,relative_humidity_2m,wind_speed_10m
        function fetchData() {
            document.getElementById('loader').classList.remove('d-none');
            const url = document.getElementById('basic-url').value;
            fetch(url)
                .then(response => {
                    const contentType = response.headers.get('content-type');
                    if (contentType.includes('application/json')) {
                        return response.json(); // JSON
                    } else if (contentType.includes('application/xml') || contentType.includes('text/xml')) {
                        return response.text(); // XML
                    } else {
                        throw new Error('Неизвестный формат данных');
                    }
                })
                .then(data => {
                    let jsonData;
                    let xmlData;

                    if (typeof data === 'string') {
                        // Если это XML, преобразуем его в JSON
                        xmlData = data;
                        xmlData = xmlFormatter(xmlData, {
                            indentation: '  ', 
                            filter: (node) => node.type !== 'Comment', 
                            collapseContent: true, 
                            lineSeparator: '\n'
                        });
                        // Убираем из JSON лишние поля и форматируем
                        function nativeType(value) {
                            var nValue = Number(value);
                            if (!isNaN(nValue)) {
                            return nValue;
                            }
                            var bValue = value.toLowerCase();
                            if (bValue === 'true') {
                            return true;
                            } else if (bValue === 'false') {
                            return false;
                            }
                            return value;
                        }

                        var removeJsonTextAttribute = function(value, parentElement) {
                            try {
                            var keyNo = Object.keys(parentElement._parent).length;
                            var keyName = Object.keys(parentElement._parent)[keyNo - 1];
                            parentElement._parent[keyName] = nativeType(value);
                            } catch (e) {}
                        }

                        var jsonOptions = {
                            compact: true,
                            trim: true,
                            ignoreDeclaration: true,
                            ignoreInstruction: true,
                            ignoreAttributes: true,
                            ignoreComment: true,
                            ignoreCdata: true,
                            ignoreDoctype: true,
                            textFn: removeJsonTextAttribute,
                            spaces: 2,
                        };
                        jsonData = xml2json(xmlData, jsonOptions);
                        document.getElementById('xml-responce').classList.remove('d-none');
                        document.getElementById('json-responce').classList.add('d-none');
                    } else {
                        // Если это JSON
                        jsonData = data;
                        jsonData = JSON.stringify(data, null, 4);

                        // Преобразуем JSON в XML и форматируем
                        const xmlOptions = { compact: true, ignoreComment: true, spaces: 2 };
                        xmlData = json2xml(data, xmlOptions);

                        document.getElementById('json-responce').classList.remove('d-none');
                        document.getElementById('xml-responce').classList.add('d-none');
                        
                    }

                    // Получение элементов для отображения
                    const jsonCodeElement = document.getElementById('json-code');
                    const xmlCodeElement = document.getElementById('xml-code');

                    // Установка текста JSON и XML в элементы
                    jsonCodeElement.textContent = jsonData;
                    xmlCodeElement.textContent = xmlData;

                    // Инициализация highlight.js
                    hljs.highlightAll();
                })
                .catch(error => {
                    console.log(error)
                    showErrorModal(error.message);
                    console.error('Ошибка при выполнении запроса:', error);
                })
                .finally(() => {
                    document.getElementById('loader').classList.add('d-none');
                });
        }
        function showErrorModal(errorMessage) {
            // Устанавливаем сообщение об ошибке
            document.getElementById('modalErrorMessage').textContent = 'Произошла ошибка при выполнении запроса.' + ' ' + errorMessage;

            // Инициализируем и показываем модальное окно Bootstrap
            var errorModal = new bootstrap.Modal(document.getElementById('errorModal'), {
                keyboard: true
            });
            errorModal.show();
            }
    </script>

</body>
</html>